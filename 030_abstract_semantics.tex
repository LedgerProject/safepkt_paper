\section{Abstract Semantics}\label{sec:abstract_semantics}

\begin{definition}[Types]
  The set of \emph{types} is defined as:
  \begin{align*}
    \mathsf{T} ::=&\ \mathsf{int} & \text{integer}\\
    | &\ \borrow\{\mathsf{w}_1,\ldots,\mathsf{w}_n\} & \text{borrow}\\
    | &\ \mathtt{mut}\borrow\{\mathsf{w}_1,\ldots,\mathsf{w}_n\} & \text{mutable borrow}\\
    | &\ \mathtt{box}\ \mathsf{T} & \text{box}\\
    | &\ \bot & \text{undefined}
  \end{align*}
  where $n\ge 1$ and $\mathsf{w}_i$ is a leftvalue, for $1\le i\le n$.
\end{definition}

An \emph{abstract store} maps variables to types:

\begin{definition}[Abstract stores]
  The set $\mathbb{AS}$ of \emph{abstract stores} contains bindings
  from variables to types, decorated with a lifetime:
  \[
  \mathbb{AS}=\{x\to^m t\mid x\in\Vars,\ t\in\mathsf{T}\text{ and }m\in\Lifetimes\}
  \]
\end{definition}

\begin{definition}[Concretization map]
  An abstract store $a\in\mathbb{AS}$ represents a set of concrete stores, according
  to the following \emph{concretization map} $\gamma$:
  \[
  \gamma(a)=\left\{\rho\star h\in\mathbb{S}\left|\begin{array}{l}
  \text{for every }x\to^m\ell\in\rho\text{ there exists }x\to^m t\in a\text{ s.t. }\ell\approx_{\rho\star h}t
  \end{array}
  \right.\right\}
  \]
  where
  \begin{align*}
    \ell&\approx_{\rho\star h}\mathsf{int} & \text{if $h(\ell)\in\mathbb{Z}$}\\
    \ell&\approx_{\rho\star h}\borrow\{\mathsf{w}_1,\ldots,\mathsf{w}_n\} & \text{if $\exists i.1\le i\le n$ s.t.\ }\loc(\mathsf{w}_i,s)\to\ell\in\rho\\
    \ell&\approx_{\rho\star h}\mathtt{mut}\borrow\{\mathsf{w}_1,\ldots,\mathsf{w}_n\} & \text{if $\exists i.1\le i\le n$ s.t.\ }\loc(\mathsf{w}_i,s)\leadsto\ell\in\rho\\
    \ell&\approx_{\rho\star h}\mathtt{box}\ t & \text{if $\ell\Rightarrow\ell'\in h$ and $\ell'\approx_{\rho\star h}t$}\\
    \ell&\approx_{\rho\star h}\bot & \text{if $h(\ell)$ is undefined}
  \end{align*}
\end{definition}
